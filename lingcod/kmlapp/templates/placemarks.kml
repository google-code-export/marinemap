{% extends "style.kml" %}
{% block folders_and_placemarks %}
{% load rest_uid array_uid mpa_uid absurl %}
{% for array_nameid, a in shapes.items %}
	{% if a.array.id and use_network_links %}
    <NetworkLink>
     <name>{{ a.array.name }}</name>
     <open>1</open>
     <visibility>0</visibility>
     <Link>
      <href>{% absurl kmlapp-array-kmz input_array_id=a.array.id session_key=session_key %}</href>
     </Link>
    </NetworkLink>
    {% else %}

 <Folder>
  <name>{{ a.array.name }}</name>
  {% if a.array.id %}
  <atom:link rel="marinemap.update_form" title="Edit {{a.array.name}}" mm:icon="/path/to/icon.jpg" mm:model="{% array_uid %}" href="{% url array_update_form pk=a.array.id %}" />
  <atom:link rel="self" title="{{ a.array.name }}" mm:model="{% array_uid %}" href="{{ a.array.get_absolute_url }}" />
  {% endif %}
  <visibility>1</visibility>
  <open>0</open>
  	<Placemark>
		<name>test</name>
		<LookAt>
			<longitude>-119.9992614752373</longitude>
			<latitude>33.95393012330412</latitude>
			<altitude>0</altitude>
			<range>206039.6304487483</range>
			<tilt>0</tilt>
			<heading>0.2347482162429508</heading>
			<altitudeMode>relativeToGround</altitudeMode>
			<gx:altitudeMode>relativeToSeaFloor</gx:altitudeMode>
		</LookAt>
		<styleUrl>#msn_ylw-pushpin</styleUrl>
		<Point>
			<coordinates>-119.9992614752373,33.95393012330412,0</coordinates>
		</Point>
	</Placemark>
 {% for mpa in a.mpas %} 

    <Placemark id="mpa_{{ mpa.id }}">
        <name>{{ mpa.name }}</name>
        <styleUrl>#{{ mpa.designation.acronym }}-style</styleUrl>
        <atom:link rel="marinemap.update_form" title="Edit" mm:icon="/path/to/icon.jpg" mm:model="{% mpa_uid %}" href="{% url mpa_update_form pk=mpa.pk %}" />
        <atom:link rel="self" title="{{mpa.name}}" mm:model="{% mpa_uid %}" href="{{mpa.get_absolute_url}}" />
        <ExtendedData>
            <Data name="mpaid"><value>{{ mpa.id }}</value></Data>
            <Data name="name"><value>{{ mpa.name }}</value></Data>
            <Data name="user"><value>{{ mpa.user }}</value></Data>
            <Data name="created"><value>{{ mpa.date_created }}</value></Data>
            <Data name="modified"><value>{{ mpa.date_modified }}</value></Data>
            <Data name="area"><value>{{ mpa.geometry_final.area }}</value></Data>
            <Data name="designation"><value>{{ mpa.designation }}</value></Data>
        </ExtendedData>
        <MultiGeometry>
        {{ mpa.centroid_kml|safe }} 
        {{ mpa.kml|safe }} 
        </MultiGeometry>
    </Placemark>

 {% endfor %}
 </Folder>

    {% endif %}
{% endfor %}
{% endblock %}
