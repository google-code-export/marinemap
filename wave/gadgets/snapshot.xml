<?xml version="1.0" encoding="UTF-8" ?> 
<Module>
<ModulePrefs title="State Example" height="120">
    <Require feature="wave" /> 
  </ModulePrefs>
<Content type="html">
<![CDATA[ 
<div id="content_div" style="padding:2px; margin:5px;background:#F2F8F7 url('http://marinemap.googlecode.com/svn/trunk/wave/gadgets/camera.png') no-repeat 3px center; border:solid #82C5DD 2px; -webkit-border-radius:5px; padding-left:25px;">
    <a onclick="linkClicked(); return false;" href="#"> Map Snapshot Added</a>
</div>
    <script type="text/javascript">

    var div = document.getElementById('content_div');

    function linkClicked(stateCallback){
        alert('link clicked');
        var snapshot = wave.getState().get('snapshot');
        gadgets.rpc.call('top', 'show_snapshot', null, snapshot);
    }

    function buttonClicked() {
      var value = parseInt(wave.getState().get('count', '0'));
      wave.getState().submitDelta({'count': value + 1});
    }

    // Reset value of "count" to 0
    function resetCounter(){
      wave.getState().submitDelta({'count': '0'});
    }

    function stateUpdated() {
      if(!wave.getState().get('count')) {
        div.innerHTML = "The count is 0."
      }
      else {
        div.innerHTML = "The count is " + wave.getState().get('count');
      } 
    }
 
    function init() {
        var relay_url = 'http://mm-01.msi.ucsb.edu/media/rpc_relay.html';
        gadgets.rpc.setRelayUrl('top', relay_url, false);
        gadgets.rpc.call('top', 'map_state_initialize', false, window.name);
      if (wave && wave.isInWaveContainer()) {
          var snapshot = wave.getState().get('snapshot');
          if(snapshot){
              gadgets.rpc.call('top', 'show_snapshot', null, snapshot);
          }else{
              gadgets.rpc.call('top', 'sync_snapshot', function(snapshot));
          }
      }
    }
    gadgets.util.registerOnLoadHandler(init);

    </script>
  ]]> 
  </Content>
</Module>